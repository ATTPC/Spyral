
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the Spyral AT-TPC analysis framework">
      
      
      
        <link rel="canonical" href="https://example.com/api/core/track_generator/">
      
      
        <link rel="prev" href="../spy_log/">
      
      
        <link rel="next" href="../workspace/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.14">
    
    
      
        <title>track_generator - Spyral</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.10ba22f1.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#track_generator-module" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Spyral" class="md-header__button md-logo" aria-label="Spyral" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Spyral
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              track_generator
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/turinath/Spyral/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Spyral" class="md-nav__button md-logo" aria-label="Spyral" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Spyral
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/turinath/Spyral/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../quick_start/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Configuration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/config/about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About Configurations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/config/workspace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workspace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/config/run/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/config/detector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Detector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/config/traces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GET & FRIB Traces
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/config/cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/config/estimate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Estimate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/config/solver/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Solver
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/config/extending/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extending the Config
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Analysis Phases
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Analysis Phases
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/phases/about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About Phases
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/phases/point_cloud/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Point Cloud
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/phases/cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/phases/estimate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Estimate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/phases/solve/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Solve
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/numba/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Numba
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/parallel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parallel Processing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/notebooks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Notebooks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/continuing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    After Spyral
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spyral Reference
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../run_parallel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    run_parallel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../run/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    run
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../phase_pointcloud/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    phase_pointcloud
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../phase_cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    phase_cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../phase_estimate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    phase_estimate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../phase_solve/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    phase_solve
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_8" checked>
        
          
          <label class="md-nav__link" for="__nav_4_8" id="__nav_4_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    core
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_8">
            <span class="md-nav__icon md-icon"></span>
            core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About core
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../clusterize/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    clusterize
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../constants/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    constants
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../estimator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    estimator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hardware_id/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hardware_id
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pad_map/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pad_map
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../particle_id.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    particle_id
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../point_cloud/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    point_cloud
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spy_log/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    spy_log
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    track_generator
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    track_generator
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#spyral.core.track_generator" class="md-nav__link">
    <span class="md-ellipsis">
      track_generator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyral.core.track_generator.MeshParameters" class="md-nav__link">
    <span class="md-ellipsis">
      MeshParameters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MeshParameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spyral.core.track_generator.MeshParameters.serialize_json" class="md-nav__link">
    <span class="md-ellipsis">
      serialize_json
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyral.core.track_generator.backward_z_bound_condition" class="md-nav__link">
    <span class="md-ellipsis">
      backward_z_bound_condition
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyral.core.track_generator.check_mesh_needs_generation" class="md-nav__link">
    <span class="md-ellipsis">
      check_mesh_needs_generation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyral.core.track_generator.equation_of_motion" class="md-nav__link">
    <span class="md-ellipsis">
      equation_of_motion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyral.core.track_generator.forward_z_bound_condition" class="md-nav__link">
    <span class="md-ellipsis">
      forward_z_bound_condition
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyral.core.track_generator.generate_interpolated_track" class="md-nav__link">
    <span class="md-ellipsis">
      generate_interpolated_track
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyral.core.track_generator.generate_track_mesh" class="md-nav__link">
    <span class="md-ellipsis">
      generate_track_mesh
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyral.core.track_generator.rho_bound_condition" class="md-nav__link">
    <span class="md-ellipsis">
      rho_bound_condition
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyral.core.track_generator.stop_condition" class="md-nav__link">
    <span class="md-ellipsis">
      stop_condition
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workspace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    workspace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../legacy_beam_pads/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    legacy_beam_pads
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_9" >
        
          
          <label class="md-nav__link" for="__nav_4_9" id="__nav_4_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    correction
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_9">
            <span class="md-nav__icon md-icon"></span>
            correction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../correction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About correction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../correction/generate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    generate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../correction/electron_corrector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    electron_corrector
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_10" >
        
          
          <label class="md-nav__link" for="__nav_4_10" id="__nav_4_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    geometry
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_10">
            <span class="md-nav__icon md-icon"></span>
            geometry
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../geometry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About geometry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../geometry/circle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    circle
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_11" >
        
          
          <label class="md-nav__link" for="__nav_4_11" id="__nav_4_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    interpolate
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_11">
            <span class="md-nav__icon md-icon"></span>
            interpolate
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../interpolate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About interpolate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../interpolate/bilinear/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bilinear
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../interpolate/linear/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    linear
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_12" >
        
          
          <label class="md-nav__link" for="__nav_4_12" id="__nav_4_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    parallel
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_12">
            <span class="md-nav__icon md-icon"></span>
            parallel
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../parallel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About parallel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../parallel/run_stack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    run_stack
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../parallel/status_message/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    status_message
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_13" >
        
          
          <label class="md-nav__link" for="__nav_4_13" id="__nav_4_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    solvers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_13">
            <span class="md-nav__icon md-icon"></span>
            solvers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../solvers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About solvers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../solvers/guess/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    guess
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../solvers/solver_interp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    solver_interp
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_14" >
        
          
          <label class="md-nav__link" for="__nav_4_14" id="__nav_4_14_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    trace
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_14">
            <span class="md-nav__icon md-icon"></span>
            trace
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../trace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About trace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../trace/get_event/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    get_event
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../trace/get_legacy_event/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    get_legacy_event
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../trace/get_trace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    get_trace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../trace/frib_event/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    frib_event
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../trace/frib_trace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    frib_trace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../trace/peak/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    peak
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../for_devs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    For Developers
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#spyral.core.track_generator" class="md-nav__link">
    <span class="md-ellipsis">
      track_generator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyral.core.track_generator.MeshParameters" class="md-nav__link">
    <span class="md-ellipsis">
      MeshParameters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MeshParameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spyral.core.track_generator.MeshParameters.serialize_json" class="md-nav__link">
    <span class="md-ellipsis">
      serialize_json
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyral.core.track_generator.backward_z_bound_condition" class="md-nav__link">
    <span class="md-ellipsis">
      backward_z_bound_condition
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyral.core.track_generator.check_mesh_needs_generation" class="md-nav__link">
    <span class="md-ellipsis">
      check_mesh_needs_generation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyral.core.track_generator.equation_of_motion" class="md-nav__link">
    <span class="md-ellipsis">
      equation_of_motion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyral.core.track_generator.forward_z_bound_condition" class="md-nav__link">
    <span class="md-ellipsis">
      forward_z_bound_condition
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyral.core.track_generator.generate_interpolated_track" class="md-nav__link">
    <span class="md-ellipsis">
      generate_interpolated_track
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyral.core.track_generator.generate_track_mesh" class="md-nav__link">
    <span class="md-ellipsis">
      generate_track_mesh
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyral.core.track_generator.rho_bound_condition" class="md-nav__link">
    <span class="md-ellipsis">
      rho_bound_condition
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyral.core.track_generator.stop_condition" class="md-nav__link">
    <span class="md-ellipsis">
      stop_condition
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="track_generator-module">track_generator Module</h1>
<p>The code defining a trajectory interpolation object and its creation.</p>


<div class="doc doc-object doc-module">



<a id="spyral.core.track_generator"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="spyral.core.track_generator.MeshParameters" class="doc doc-heading">
          <code>MeshParameters</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">

  
      <p>Wrapper for the general parameters required to generate a mesh of ODE solutions</p>
<p>A mesh for Spyral is a 4 dimensional array of solutions to the equations of motion (also
called track or trajectory) through the AT-TPC detector. These parameters describe
the shape of the mesh as well as the physical properties used to generate it.</p>



  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code><span title="spyral.core.track_generator.MeshParameters.target">target</span></code></td>
          <td>
                <code><span title="spyral_utils.nuclear.target.GasTarget">GasTarget</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The target material</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="spyral.core.track_generator.MeshParameters.particle">particle</span></code></td>
          <td>
                <code><span title="spyral_utils.nuclear.NucleusData">NucleusData</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The projectile</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="spyral.core.track_generator.MeshParameters.bfield">bfield</span></code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The magnetic field magnitude in T</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="spyral.core.track_generator.MeshParameters.efield">efield</span></code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The electric field magnitude in V/m</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="spyral.core.track_generator.MeshParameters.n_time_steps">n_time_steps</span></code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The number of ODE solver timesteps</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="spyral.core.track_generator.MeshParameters.ke_min">ke_min</span></code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The minimum kinetic energy of the mesh in MeV</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="spyral.core.track_generator.MeshParameters.ke_max">ke_max</span></code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The maximum kinetic energy of the mesh in MeV</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="spyral.core.track_generator.MeshParameters.ke_bins">ke_bins</span></code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The number of kinetic energy bins in the mesh</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="spyral.core.track_generator.MeshParameters.polar_min">polar_min</span></code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The minimum polar angle of the mesh in degrees</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="spyral.core.track_generator.MeshParameters.polar_max">polar_max</span></code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The maximum polar angle of the mesh in degrees</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="spyral.core.track_generator.MeshParameters.polar_bins">polar_bins</span></code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The number of polar angle bins in the mesh</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Methods:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
          <tr>
            <td><code><a class="autorefs autorefs-internal" title="spyral.core.track_generator.MeshParameters.serialize_json" href="#spyral.core.track_generator.MeshParameters.serialize_json">serialize_json</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>Serialize the class to a JSON string</p>
              </div>
            </td>
          </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>spyral/core/track_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">MeshParameters</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper for the general parameters required to generate a mesh of ODE solutions</span>

<span class="sd">    A mesh for Spyral is a 4 dimensional array of solutions to the equations of motion (also</span>
<span class="sd">    called track or trajectory) through the AT-TPC detector. These parameters describe</span>
<span class="sd">    the shape of the mesh as well as the physical properties used to generate it.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    target: spyral_utils.nuclear.target.GasTarget</span>
<span class="sd">        The target material</span>
<span class="sd">    particle: spyral_utils.nuclear.NucleusData</span>
<span class="sd">        The projectile</span>
<span class="sd">    bfield: float</span>
<span class="sd">        The magnetic field magnitude in T</span>
<span class="sd">    efield: float</span>
<span class="sd">        The electric field magnitude in V/m</span>
<span class="sd">    n_time_steps: int</span>
<span class="sd">        The number of ODE solver timesteps</span>
<span class="sd">    ke_min: float</span>
<span class="sd">        The minimum kinetic energy of the mesh in MeV</span>
<span class="sd">    ke_max: float</span>
<span class="sd">        The maximum kinetic energy of the mesh in MeV</span>
<span class="sd">    ke_bins: int</span>
<span class="sd">        The number of kinetic energy bins in the mesh</span>
<span class="sd">    polar_min: float</span>
<span class="sd">        The minimum polar angle of the mesh in degrees</span>
<span class="sd">    polar_max: float</span>
<span class="sd">        The maximum polar angle of the mesh in degrees</span>
<span class="sd">    polar_bins: int</span>
<span class="sd">        The number of polar angle bins in the mesh</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    serialize_json() -&gt; str</span>
<span class="sd">        Serialize the class to a JSON string</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">target</span><span class="p">:</span> <span class="n">GasTarget</span>
    <span class="n">particle</span><span class="p">:</span> <span class="n">NucleusData</span>
    <span class="n">bfield</span><span class="p">:</span> <span class="nb">float</span>  <span class="c1"># T</span>
    <span class="n">efield</span><span class="p">:</span> <span class="nb">float</span>  <span class="c1"># V/m</span>
    <span class="n">n_time_steps</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">ke_min</span><span class="p">:</span> <span class="nb">float</span>  <span class="c1"># MeV</span>
    <span class="n">ke_max</span><span class="p">:</span> <span class="nb">float</span>  <span class="c1"># MeV</span>
    <span class="n">ke_bins</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">polar_min</span><span class="p">:</span> <span class="nb">float</span>  <span class="c1"># deg</span>
    <span class="n">polar_max</span><span class="p">:</span> <span class="nb">float</span>  <span class="c1"># deg</span>
    <span class="n">polar_bins</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="nf">serialize_json</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Serialize the class to a JSON string</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            A JSON string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;particle&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">particle</span><span class="o">.</span><span class="n">isotopic_symbol</span><span class="p">,</span>
                <span class="s2">&quot;gas&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">pretty_string</span><span class="p">,</span>
                <span class="s2">&quot;bfield&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">bfield</span><span class="p">,</span>
                <span class="s2">&quot;efield&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">efield</span><span class="p">,</span>
                <span class="s2">&quot;time_steps&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">n_time_steps</span><span class="p">,</span>
                <span class="s2">&quot;ke_min&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">ke_min</span><span class="p">,</span>
                <span class="s2">&quot;ke_max&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">ke_max</span><span class="p">,</span>
                <span class="s2">&quot;ke_bins&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">ke_bins</span><span class="p">,</span>
                <span class="s2">&quot;polar_min&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">polar_min</span><span class="p">,</span>
                <span class="s2">&quot;polar_max&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">polar_max</span><span class="p">,</span>
                <span class="s2">&quot;polar_bins&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">polar_bins</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="spyral.core.track_generator.MeshParameters.serialize_json" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">serialize_json</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Serialize the class to a JSON string</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A JSON string</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>spyral/core/track_generator.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">serialize_json</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Serialize the class to a JSON string</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        A JSON string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;particle&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">particle</span><span class="o">.</span><span class="n">isotopic_symbol</span><span class="p">,</span>
            <span class="s2">&quot;gas&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">pretty_string</span><span class="p">,</span>
            <span class="s2">&quot;bfield&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">bfield</span><span class="p">,</span>
            <span class="s2">&quot;efield&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">efield</span><span class="p">,</span>
            <span class="s2">&quot;time_steps&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">n_time_steps</span><span class="p">,</span>
            <span class="s2">&quot;ke_min&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">ke_min</span><span class="p">,</span>
            <span class="s2">&quot;ke_max&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">ke_max</span><span class="p">,</span>
            <span class="s2">&quot;ke_bins&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">ke_bins</span><span class="p">,</span>
            <span class="s2">&quot;polar_min&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">polar_min</span><span class="p">,</span>
            <span class="s2">&quot;polar_max&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">polar_max</span><span class="p">,</span>
            <span class="s2">&quot;polar_bins&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">polar_bins</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>



<div class="doc doc-object doc-function">



<h2 id="spyral.core.track_generator.backward_z_bound_condition" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">backward_z_bound_condition</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">Bfield</span><span class="p">,</span> <span class="n">Efield</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">ejectile</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Detect if a solution has reached the end-of-detector-in-z condition</p>
<p>Terminate the integration of the ivp if the condition specified has been reached.
Scipy finds the roots of this function with the ivp. The parameters must match
those given to the equation to be solved</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>t</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>time step, unused</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>state</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the state of the particle (x,y,z,vx,vy,vz)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Bfield</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the magnitude of the magnetic field, unused</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Efield</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the magnitude of the electric field, unused</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>target</code></td>
          <td>
                <code><span title="spyral_utils.nuclear.target.GasTarget">GasTarget</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the material through which the particle travels, unused</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>ejectile</code></td>
          <td>
                <code><span title="spyral_utils.nuclear.NucleusData">NucleusData</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>ejectile (from the reaction) nucleus data, unused</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The difference between the current z position and the beginning of the detector (-1.0 m). When
this function returns zero the termination condition has been reached.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>spyral/core/track_generator.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">backward_z_bound_condition</span><span class="p">(</span>
    <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">Bfield</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">Efield</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">target</span><span class="p">:</span> <span class="n">GasTarget</span><span class="p">,</span>
    <span class="n">ejectile</span><span class="p">:</span> <span class="n">NucleusData</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detect if a solution has reached the end-of-detector-in-z condition</span>

<span class="sd">    Terminate the integration of the ivp if the condition specified has been reached.</span>
<span class="sd">    Scipy finds the roots of this function with the ivp. The parameters must match</span>
<span class="sd">    those given to the equation to be solved</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t: float</span>
<span class="sd">        time step, unused</span>
<span class="sd">    state: ndarray</span>
<span class="sd">        the state of the particle (x,y,z,vx,vy,vz)</span>
<span class="sd">    Bfield: float</span>
<span class="sd">        the magnitude of the magnetic field, unused</span>
<span class="sd">    Efield: float</span>
<span class="sd">        the magnitude of the electric field, unused</span>
<span class="sd">    target: Target</span>
<span class="sd">        the material through which the particle travels, unused</span>
<span class="sd">    ejectile: NucleusData</span>
<span class="sd">        ejectile (from the reaction) nucleus data, unused</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The difference between the current z position and the beginning of the detector (-1.0 m). When</span>
<span class="sd">        this function returns zero the termination condition has been reached.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="spyral.core.track_generator.check_mesh_needs_generation" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">check_mesh_needs_generation</span><span class="p">(</span><span class="n">track_path</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Check if track mesh meta data matches or if track mesh doesn't exist</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>track_path</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Path to the track mesh data</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>params</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="spyral.core.track_generator.MeshParameters" href="#spyral.core.track_generator.MeshParameters">MeshParameters</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The parameters for this track mesh</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Returns True if the mesh needs to be generated</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>spyral/core/track_generator.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_mesh_needs_generation</span><span class="p">(</span><span class="n">track_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">MeshParameters</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if track mesh meta data matches or if track mesh doesn&#39;t exist</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    track_path: Path</span>
<span class="sd">        Path to the track mesh data</span>
<span class="sd">    params: MeshParamters</span>
<span class="sd">        The parameters for this track mesh</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        Returns True if the mesh needs to be generated</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">track_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">meta_path</span> <span class="o">=</span> <span class="n">track_path</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">track_path</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">.json&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">meta_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">meta_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">meta_file</span><span class="p">:</span>
            <span class="n">meta_str</span> <span class="o">=</span> <span class="n">meta_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">params</span><span class="o">.</span><span class="n">serialize_json</span><span class="p">()</span> <span class="o">!=</span> <span class="n">meta_str</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="spyral.core.track_generator.equation_of_motion" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">equation_of_motion</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">Bfield</span><span class="p">,</span> <span class="n">Efield</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">ejectile</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>The equations of motion for a charged particle in a static electromagnetic field which experiences energy loss through some material.</p>
<p>Field directions are chosen based on standard AT-TPC configuration</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>t</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>time step</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>state</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the state of the particle (x,y,z,vx,vy,vz)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Bfield</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the magnitude of the magnetic field</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Efield</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the magnitude of the electric field</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>target</code></td>
          <td>
                <code><span title="spyral_utils.nuclear.target.GasTarget">GasTarget</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the material through which the particle travels</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>ejectile</code></td>
          <td>
                <code><span title="spyral_utils.nuclear.NucleusData">NucleusData</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>ejectile (from the reaction) nucleus data</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ndarray</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the derivatives of the state</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>spyral/core/track_generator.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">equation_of_motion</span><span class="p">(</span>
    <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">Bfield</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">Efield</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">target</span><span class="p">:</span> <span class="n">GasTarget</span><span class="p">,</span>
    <span class="n">ejectile</span><span class="p">:</span> <span class="n">NucleusData</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The equations of motion for a charged particle in a static electromagnetic field which experiences energy loss through some material.</span>

<span class="sd">    Field directions are chosen based on standard AT-TPC configuration</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t: float</span>
<span class="sd">        time step</span>
<span class="sd">    state: ndarray</span>
<span class="sd">        the state of the particle (x,y,z,vx,vy,vz)</span>
<span class="sd">    Bfield: float</span>
<span class="sd">        the magnitude of the magnetic field</span>
<span class="sd">    Efield: float</span>
<span class="sd">        the magnitude of the electric field</span>
<span class="sd">    target: Target</span>
<span class="sd">        the material through which the particle travels</span>
<span class="sd">    ejectile: NucleusData</span>
<span class="sd">        ejectile (from the reaction) nucleus data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ndarray</span>
<span class="sd">        the derivatives of the state</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">speed</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">**</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">state</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">**</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">state</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span>

    <span class="n">unit_vector</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span> <span class="o">/</span> <span class="n">speed</span>  <span class="c1"># direction</span>
    <span class="n">kinetic_energy</span> <span class="o">=</span> <span class="n">ejectile</span><span class="o">.</span><span class="n">mass</span> <span class="o">*</span> <span class="p">(</span>
        <span class="mf">1.0</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">speed</span> <span class="o">/</span> <span class="n">C</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span>
    <span class="p">)</span>  <span class="c1"># MeV</span>

    <span class="n">mass_kg</span> <span class="o">=</span> <span class="n">ejectile</span><span class="o">.</span><span class="n">mass</span> <span class="o">*</span> <span class="n">MEV_2_KG</span>
    <span class="n">charge_c</span> <span class="o">=</span> <span class="n">ejectile</span><span class="o">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">E_CHARGE</span>
    <span class="n">qm</span> <span class="o">=</span> <span class="n">charge_c</span> <span class="o">/</span> <span class="n">mass_kg</span>

    <span class="n">deceleration</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">target</span><span class="o">.</span><span class="n">get_dedx</span><span class="p">(</span><span class="n">ejectile</span><span class="p">,</span> <span class="n">kinetic_energy</span><span class="p">)</span> <span class="o">*</span> <span class="n">MEV_2_JOULE</span> <span class="o">*</span> <span class="n">target</span><span class="o">.</span><span class="n">density</span> <span class="o">*</span> <span class="mf">100.0</span>
    <span class="p">)</span> <span class="o">/</span> <span class="n">mass_kg</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">results</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">qm</span> <span class="o">*</span> <span class="n">state</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bfield</span> <span class="o">-</span> <span class="n">deceleration</span> <span class="o">*</span> <span class="n">unit_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">results</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">qm</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">state</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bfield</span><span class="p">)</span> <span class="o">-</span> <span class="n">deceleration</span> <span class="o">*</span> <span class="n">unit_vector</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">results</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">qm</span> <span class="o">*</span> <span class="n">Efield</span> <span class="o">-</span> <span class="n">deceleration</span> <span class="o">*</span> <span class="n">unit_vector</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="spyral.core.track_generator.forward_z_bound_condition" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">forward_z_bound_condition</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">Bfield</span><span class="p">,</span> <span class="n">Efield</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">ejectile</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Detect if a solution has reached the end-of-detector-in-z condition</p>
<p>Terminate the integration of the ivp if the condition specified has been reached.
Scipy finds the roots of this function with the ivp. The parameters must match
those given to the equation to be solved</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>t</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>time step, unused</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>state</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the state of the particle (x,y,z,vx,vy,vz)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Bfield</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the magnitude of the magnetic field, unused</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Efield</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the magnitude of the electric field, unused</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>target</code></td>
          <td>
                <code><span title="spyral_utils.nuclear.target.GasTarget">GasTarget</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the material through which the particle travels, unused</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>ejectile</code></td>
          <td>
                <code><span title="spyral_utils.nuclear.NucleusData">NucleusData</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>ejectile (from the reaction) nucleus data, unused</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The difference between the current z position and the length of the detector (1m). When
this function returns zero the termination condition has been reached.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>spyral/core/track_generator.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">forward_z_bound_condition</span><span class="p">(</span>
    <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">Bfield</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">Efield</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">target</span><span class="p">:</span> <span class="n">GasTarget</span><span class="p">,</span>
    <span class="n">ejectile</span><span class="p">:</span> <span class="n">NucleusData</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detect if a solution has reached the end-of-detector-in-z condition</span>

<span class="sd">    Terminate the integration of the ivp if the condition specified has been reached.</span>
<span class="sd">    Scipy finds the roots of this function with the ivp. The parameters must match</span>
<span class="sd">    those given to the equation to be solved</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t: float</span>
<span class="sd">        time step, unused</span>
<span class="sd">    state: ndarray</span>
<span class="sd">        the state of the particle (x,y,z,vx,vy,vz)</span>
<span class="sd">    Bfield: float</span>
<span class="sd">        the magnitude of the magnetic field, unused</span>
<span class="sd">    Efield: float</span>
<span class="sd">        the magnitude of the electric field, unused</span>
<span class="sd">    target: Target</span>
<span class="sd">        the material through which the particle travels, unused</span>
<span class="sd">    ejectile: NucleusData</span>
<span class="sd">        ejectile (from the reaction) nucleus data, unused</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The difference between the current z position and the length of the detector (1m). When</span>
<span class="sd">        this function returns zero the termination condition has been reached.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1.0</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="spyral.core.track_generator.generate_interpolated_track" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">generate_interpolated_track</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">,</span> <span class="n">polar</span><span class="p">,</span> <span class="n">azim</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">particle</span><span class="p">,</span> <span class="n">bfield</span><span class="p">,</span> <span class="n">efield</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">n_time_steps</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Get a single interpolated trajectory given some initial state and system parameters</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>vx</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Vertex x-coordinate in m</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>vy</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Vertex y-coordinate in m</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>vz</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Vertex z-coordinate in m</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>polar</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Polar angle in radians</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>azim</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>azimuthal angle in radians</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>ke</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Kinetic energy in MeV</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>particle</code></td>
          <td>
                <code><span title="spyral_utils.nuclear.NucleusData">NucleusData</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The particle of interest</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>bfield</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The magnetic field in Tesla</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>efield</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The electric field in V/m</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>target</code></td>
          <td>
                <code><span title="spyral_utils.nuclear.target.GasTarget">GasTarget</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The target material</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>n_time_steps</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The number of timesteps used by the solver</p>
            </div>
          </td>
          <td>
                <code>1000</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="spyral.interpolate.LinearInterpolator" href="../../interpolate/linear/#spyral.interpolate.linear.LinearInterpolator">LinearInterpolator</a> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Returns a LinearInterpolator, which interpolates the trajectory upon z for x,y or None when the algorithm fails</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>spyral/core/track_generator.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_interpolated_track</span><span class="p">(</span>
    <span class="n">vx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">vy</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">vz</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">polar</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">azim</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">ke</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">particle</span><span class="p">:</span> <span class="n">NucleusData</span><span class="p">,</span>
    <span class="n">bfield</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">efield</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">target</span><span class="p">:</span> <span class="n">GasTarget</span><span class="p">,</span>
    <span class="n">n_time_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LinearInterpolator</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a single interpolated trajectory given some initial state and system parameters</span>

<span class="sd">    Parameters</span>
<span class="sd">    -------------</span>
<span class="sd">    vx: float</span>
<span class="sd">        Vertex x-coordinate in m</span>
<span class="sd">    vy: float</span>
<span class="sd">        Vertex y-coordinate in m</span>
<span class="sd">    vz: float</span>
<span class="sd">        Vertex z-coordinate in m</span>
<span class="sd">    polar: float</span>
<span class="sd">        Polar angle in radians</span>
<span class="sd">    azim: float</span>
<span class="sd">        azimuthal angle in radians</span>
<span class="sd">    ke: float</span>
<span class="sd">        Kinetic energy in MeV</span>
<span class="sd">    particle: NucleusData</span>
<span class="sd">        The particle of interest</span>
<span class="sd">    bfield: float</span>
<span class="sd">        The magnetic field in Tesla</span>
<span class="sd">    efield: float</span>
<span class="sd">        The electric field in V/m</span>
<span class="sd">    target: GasTarget</span>
<span class="sd">        The target material</span>
<span class="sd">    n_time_steps: int</span>
<span class="sd">        The number of timesteps used by the solver</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    LinearInterpolator | None</span>
<span class="sd">        Returns a LinearInterpolator, which interpolates the trajectory upon z for x,y or None when the algorithm fails</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Termination conditions</span>
    <span class="n">stop_condition</span><span class="o">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">stop_condition</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
    <span class="n">forward_z_bound_condition</span><span class="o">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">forward_z_bound_condition</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">backward_z_bound_condition</span><span class="o">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">backward_z_bound_condition</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
    <span class="n">rho_bound_condition</span><span class="o">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">rho_bound_condition</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="c1"># Setup initial state</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">ke</span> <span class="o">/</span> <span class="n">particle</span><span class="o">.</span><span class="n">mass</span> <span class="o">+</span> <span class="mf">1.0</span>
    <span class="n">speed</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">gamma</span><span class="o">**</span><span class="mf">2.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">C</span>
    <span class="n">initial_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">vx</span><span class="p">,</span>
            <span class="n">vy</span><span class="p">,</span>
            <span class="n">vz</span><span class="p">,</span>
            <span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">polar</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">azim</span><span class="p">),</span>
            <span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">polar</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">azim</span><span class="p">),</span>
            <span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">polar</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Solve coarsely to deterimine problem timescale</span>
    <span class="n">trajectory</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span>
        <span class="n">equation_of_motion</span><span class="p">,</span>
        <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">COARSE_TIME_WINDOW</span><span class="p">),</span>
        <span class="n">initial_state</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;RK45&quot;</span><span class="p">,</span>
        <span class="n">events</span><span class="o">=</span><span class="p">[</span>
            <span class="n">stop_condition</span><span class="p">,</span>
            <span class="n">forward_z_bound_condition</span><span class="p">,</span>
            <span class="n">backward_z_bound_condition</span><span class="p">,</span>
            <span class="n">rho_bound_condition</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">bfield</span><span class="p">,</span> <span class="n">efield</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">particle</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">longest_time</span> <span class="o">=</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Solve with refined scale to produce best results</span>
    <span class="n">time_steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">longest_time</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">n_time_steps</span><span class="p">)</span>
    <span class="n">trajectory</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span>
        <span class="n">equation_of_motion</span><span class="p">,</span>
        <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">longest_time</span><span class="p">),</span>
        <span class="n">initial_state</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;RK45&quot;</span><span class="p">,</span>
        <span class="n">events</span><span class="o">=</span><span class="p">[</span>
            <span class="n">stop_condition</span><span class="p">,</span>
            <span class="n">forward_z_bound_condition</span><span class="p">,</span>
            <span class="n">backward_z_bound_condition</span><span class="p">,</span>
            <span class="n">rho_bound_condition</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">bfield</span><span class="p">,</span> <span class="n">efield</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">particle</span><span class="p">),</span>
        <span class="n">t_eval</span><span class="o">=</span><span class="n">time_steps</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">trajectory</span> <span class="o">=</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">T</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trajectory</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Handle data &gt; 90 deg. LinearInterpolator requires x data (z in our case) to be monotonically increasing</span>
    <span class="c1"># So flip the array along axis 0 (flipud). Also trim data where sometimes particle starts going backward</span>
    <span class="c1"># due to efield</span>
    <span class="k">if</span> <span class="n">polar</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">:</span>
        <span class="n">trajectory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">trajectory</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">trajectory</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">trajectory</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">LinearInterpolator</span><span class="p">(</span><span class="n">trajectory</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">trajectory</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="spyral.core.track_generator.generate_track_mesh" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">generate_track_mesh</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">track_path</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Generate a mesh of tracks given some parameters and write them to an npy file at a path.</p>
<p>Creates a 4-dimensional array (mesh) of ODE solutions (also called tracks or trajectories) and
writes them to disk. The dimensions are as follows: time x initial energy x inital polar angle x position.
This mesh can then be used to interpolate and find an approximate solution for a given energy, polar angle.</p>
<p>In many cases of AT-TPC analysis, it is diffcult to pre-estimate the time window needed to cover the full
trajectory. To compensate, Spyral will do a first pass over the mesh using a coarse 1us time window.
It will then estimate a finer time window based off of the results of this first pass, and then generate the
mesh.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>params</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="spyral.core.track_generator.MeshParameters" href="#spyral.core.track_generator.MeshParameters">MeshParameters</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>parameters which control the tracks</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>track_path</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>where to write the tracks to</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>spyral/core/track_generator.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_track_mesh</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">MeshParameters</span><span class="p">,</span> <span class="n">track_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a mesh of tracks given some parameters and write them to an npy file at a path.</span>

<span class="sd">    Creates a 4-dimensional array (mesh) of ODE solutions (also called tracks or trajectories) and</span>
<span class="sd">    writes them to disk. The dimensions are as follows: time x initial energy x inital polar angle x position.</span>
<span class="sd">    This mesh can then be used to interpolate and find an approximate solution for a given energy, polar angle.</span>

<span class="sd">    In many cases of AT-TPC analysis, it is diffcult to pre-estimate the time window needed to cover the full</span>
<span class="sd">    trajectory. To compensate, Spyral will do a first pass over the mesh using a coarse 1us time window.</span>
<span class="sd">    It will then estimate a finer time window based off of the results of this first pass, and then generate the</span>
<span class="sd">    mesh.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    params: InterpolatorParameters</span>
<span class="sd">        parameters which control the tracks</span>
<span class="sd">    track_path: Path</span>
<span class="sd">        where to write the tracks to</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">ke_min</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">ke_max</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">ke_bins</span><span class="p">)</span>
    <span class="n">polars</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
        <span class="n">params</span><span class="o">.</span><span class="n">polar_min</span> <span class="o">*</span> <span class="n">DEG2RAD</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">polar_max</span> <span class="o">*</span> <span class="n">DEG2RAD</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">polar_bins</span>
    <span class="p">)</span>

    <span class="n">track_meta_path</span> <span class="o">=</span> <span class="n">track_path</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">track_path</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">.json&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">track_meta_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">metafile</span><span class="p">:</span>
        <span class="n">metafile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">serialize_json</span><span class="p">())</span>

    <span class="c1"># time x (x, y, z, vx, vy, vz) x ke x polar</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
        <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">n_time_steps</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">ke_bins</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">polar_bins</span><span class="p">),</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">initial_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

    <span class="n">bfield</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">bfield</span>
    <span class="n">efield</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">efield</span>

    <span class="n">total_iters</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">polar_bins</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">ke_bins</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">flush_percent</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="n">flush_val</span> <span class="o">=</span> <span class="n">flush_percent</span> <span class="o">*</span> <span class="n">total_iters</span>
    <span class="n">flush_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">longest_time</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="c1"># Set the conditions to be terminal for a given direction (approaching from positive or negative slope)</span>
    <span class="c1"># See scipy docs for details</span>
    <span class="n">stop_condition</span><span class="o">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">stop_condition</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
    <span class="n">forward_z_bound_condition</span><span class="o">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">forward_z_bound_condition</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">backward_z_bound_condition</span><span class="o">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">backward_z_bound_condition</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
    <span class="n">rho_bound_condition</span><span class="o">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">rho_bound_condition</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optimizing time range...&quot;</span><span class="p">)</span>

    <span class="c1"># First narrow the time range to the relevant size for the problem</span>
    <span class="k">for</span> <span class="n">eidx</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">kes</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">pidx</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">polars</span><span class="p">):</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="n">flush_val</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">flush_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">Percent of data generated: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">flush_count</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">flush_percent</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,</span>
                    <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">initial_state</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">gamma</span> <span class="o">=</span> <span class="n">e</span> <span class="o">/</span> <span class="n">params</span><span class="o">.</span><span class="n">particle</span><span class="o">.</span><span class="n">mass</span> <span class="o">+</span> <span class="mf">1.0</span>
            <span class="n">speed</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">gamma</span><span class="o">**</span><span class="mf">2.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">C</span>
            <span class="n">initial_state</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">initial_state</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span>
                <span class="n">equation_of_motion</span><span class="p">,</span>
                <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">COARSE_TIME_WINDOW</span><span class="p">),</span>
                <span class="n">initial_state</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;RK45&quot;</span><span class="p">,</span>
                <span class="n">events</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">stop_condition</span><span class="p">,</span>
                    <span class="n">forward_z_bound_condition</span><span class="p">,</span>
                    <span class="n">backward_z_bound_condition</span><span class="p">,</span>
                    <span class="n">rho_bound_condition</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">bfield</span><span class="p">,</span> <span class="n">efield</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">particle</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">longest_time</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">longest_time</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estimated time window: </span><span class="si">{</span><span class="n">longest_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">time_steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="mf">1.0e-11</span><span class="p">,</span> <span class="n">longest_time</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">n_time_steps</span><span class="p">)</span>
    <span class="c1"># time_steps = np.linspace(0.0, longest_time, num=params.n_time_steps)</span>
    <span class="n">flush_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generating mesh...&quot;</span><span class="p">)</span>
    <span class="c1"># Now redo solving, using the maximum time estimated from the first pass</span>
    <span class="k">for</span> <span class="n">eidx</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">kes</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">pidx</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">polars</span><span class="p">):</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="n">flush_val</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">flush_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">Percent of data generated: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">flush_count</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">flush_percent</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,</span>
                    <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">initial_state</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">gamma</span> <span class="o">=</span> <span class="n">e</span> <span class="o">/</span> <span class="n">params</span><span class="o">.</span><span class="n">particle</span><span class="o">.</span><span class="n">mass</span> <span class="o">+</span> <span class="mf">1.0</span>
            <span class="n">speed</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">gamma</span><span class="o">**</span><span class="mf">2.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">C</span>
            <span class="n">initial_state</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">initial_state</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span>
                <span class="n">equation_of_motion</span><span class="p">,</span>
                <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">longest_time</span><span class="p">),</span>
                <span class="n">initial_state</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;RK45&quot;</span><span class="p">,</span>
                <span class="n">events</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">stop_condition</span><span class="p">,</span>
                    <span class="n">forward_z_bound_condition</span><span class="p">,</span>
                    <span class="n">backward_z_bound_condition</span><span class="p">,</span>
                    <span class="n">rho_bound_condition</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">bfield</span><span class="p">,</span> <span class="n">efield</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">particle</span><span class="p">),</span>
                <span class="n">t_eval</span><span class="o">=</span><span class="n">time_steps</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">trajectory</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">T</span>
            <span class="n">last_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trajectory</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[:</span><span class="n">last_index</span><span class="p">,</span> <span class="p">:,</span> <span class="n">eidx</span><span class="p">,</span> <span class="n">pidx</span><span class="p">]</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">last_index</span> <span class="o">&lt;</span> <span class="n">params</span><span class="o">.</span><span class="n">n_time_steps</span><span class="p">:</span>
                <span class="c1"># Stopped, so remaining time is just final position</span>
                <span class="n">data</span><span class="p">[</span><span class="n">last_index</span><span class="p">:,</span> <span class="p">:,</span> <span class="n">eidx</span><span class="p">,</span> <span class="n">pidx</span><span class="p">]</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">track_path</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="spyral.core.track_generator.rho_bound_condition" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">rho_bound_condition</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">Bfield</span><span class="p">,</span> <span class="n">Efield</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">ejectile</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Detect if a solution has reached the end-of-detector-in-rho condition</p>
<p>Terminate the integration of the ivp if the condition specified has been reached.
Scipy finds the roots of this function with the ivp. The parameters must match
those given to the equation to be solved</p>
<p>Note here that the edge in rho (292 mm) is padded by 30 mm to account for conditions where the vertex is off axis</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>t</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>time step, unused</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>state</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the state of the particle (x,y,z,vx,vy,vz)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Bfield</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the magnitude of the magnetic field, unused</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Efield</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the magnitude of the electric field, unused</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>target</code></td>
          <td>
                <code><span title="spyral_utils.nuclear.target.GasTarget">GasTarget</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the material through which the particle travels, unused</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>ejectile</code></td>
          <td>
                <code><span title="spyral_utils.nuclear.NucleusData">NucleusData</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>ejectile (from the reaction) nucleus data, unused</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The difference between the current z position and the maximum rho of the detector (332 mm). When
this function returns zero the termination condition has been reached.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>spyral/core/track_generator.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rho_bound_condition</span><span class="p">(</span>
    <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">Bfield</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">Efield</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">target</span><span class="p">:</span> <span class="n">GasTarget</span><span class="p">,</span>
    <span class="n">ejectile</span><span class="p">:</span> <span class="n">NucleusData</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detect if a solution has reached the end-of-detector-in-rho condition</span>

<span class="sd">    Terminate the integration of the ivp if the condition specified has been reached.</span>
<span class="sd">    Scipy finds the roots of this function with the ivp. The parameters must match</span>
<span class="sd">    those given to the equation to be solved</span>

<span class="sd">    Note here that the edge in rho (292 mm) is padded by 30 mm to account for conditions where the vertex is off axis</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t: float</span>
<span class="sd">        time step, unused</span>
<span class="sd">    state: ndarray</span>
<span class="sd">        the state of the particle (x,y,z,vx,vy,vz)</span>
<span class="sd">    Bfield: float</span>
<span class="sd">        the magnitude of the magnetic field, unused</span>
<span class="sd">    Efield: float</span>
<span class="sd">        the magnitude of the electric field, unused</span>
<span class="sd">    target: Target</span>
<span class="sd">        the material through which the particle travels, unused</span>
<span class="sd">    ejectile: NucleusData</span>
<span class="sd">        ejectile (from the reaction) nucleus data, unused</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The difference between the current z position and the maximum rho of the detector (332 mm). When</span>
<span class="sd">        this function returns zero the termination condition has been reached.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">state</span><span class="p">[:</span><span class="mi">2</span><span class="p">]))</span> <span class="o">-</span> <span class="mf">0.332</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="spyral.core.track_generator.stop_condition" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">stop_condition</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">Bfield</span><span class="p">,</span> <span class="n">Efield</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">ejectile</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Detect if a solution has reached the low-energy stopping condition</p>
<p>Terminate the integration of the ivp if the condition specified has been reached.
Scipy finds the roots of this function with the ivp. The parameters must match
those given to the equation to be solved</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>t</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>time step, unused</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>state</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the state of the particle (x,y,z,vx,vy,vz)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Bfield</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the magnitude of the magnetic field, unused</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Efield</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the magnitude of the electric field, unused</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>target</code></td>
          <td>
                <code><span title="spyral_utils.nuclear.target.GasTarget">GasTarget</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the material through which the particle travels, unused</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>ejectile</code></td>
          <td>
                <code><span title="spyral_utils.nuclear.NucleusData">NucleusData</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>ejectile (from the reaction) nucleus data</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The difference between the kinetic energy and the lower limit. When
this function returns zero the termination condition has been reached.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>spyral/core/track_generator.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">stop_condition</span><span class="p">(</span>
    <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">Bfield</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">Efield</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">target</span><span class="p">:</span> <span class="n">GasTarget</span><span class="p">,</span>
    <span class="n">ejectile</span><span class="p">:</span> <span class="n">NucleusData</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detect if a solution has reached the low-energy stopping condition</span>

<span class="sd">    Terminate the integration of the ivp if the condition specified has been reached.</span>
<span class="sd">    Scipy finds the roots of this function with the ivp. The parameters must match</span>
<span class="sd">    those given to the equation to be solved</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t: float</span>
<span class="sd">        time step, unused</span>
<span class="sd">    state: ndarray</span>
<span class="sd">        the state of the particle (x,y,z,vx,vy,vz)</span>
<span class="sd">    Bfield: float</span>
<span class="sd">        the magnitude of the magnetic field, unused</span>
<span class="sd">    Efield: float</span>
<span class="sd">        the magnitude of the electric field, unused</span>
<span class="sd">    target: Target</span>
<span class="sd">        the material through which the particle travels, unused</span>
<span class="sd">    ejectile: NucleusData</span>
<span class="sd">        ejectile (from the reaction) nucleus data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The difference between the kinetic energy and the lower limit. When</span>
<span class="sd">        this function returns zero the termination condition has been reached.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">speed</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">**</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">state</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">**</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">state</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span>
    <span class="n">kinetic_energy</span> <span class="o">=</span> <span class="n">ejectile</span><span class="o">.</span><span class="n">mass</span> <span class="o">*</span> <span class="p">(</span>
        <span class="mf">1.0</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">speed</span> <span class="o">/</span> <span class="n">C</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span>
    <span class="p">)</span>  <span class="c1"># MeV</span>
    <span class="k">return</span> <span class="n">kinetic_energy</span> <span class="o">-</span> <span class="n">KE_LIMIT</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.bd41221c.min.js"></script>
      
        <script src="../../../javascript/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>